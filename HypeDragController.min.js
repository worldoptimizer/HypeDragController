/*
 Hype Drag Controller v1.4.2
 Copyright (2024) Max Ziebell, MIT License
*/
'use strict';"HypeDragController"in window===!1&&(window.HypeDragController=function(){function q(a){return a?t[a]:t}function E(){if(!document.getElementById("HypeDragControllerStyles")){var a=document.createElement("style");a.id="HypeDragControllerStyles";a.innerHTML=".hypeDragElementLocked, .hypeDragElementLocked * { pointer-events: none !important; }";document.head.appendChild(a)}}function r(a){a=a.documentId();u[a]||(u[a]={dragData:{},interactionMap:{},constraints:{},zCounter:1E4});return u[a]}
function F(a,c){const b=c.getElementById(c.currentSceneId()).querySelectorAll("[data-drop-target]"),d=c.getElementProperty(a,"left"),e=c.getElementProperty(a,"top"),f=c.getElementProperty(a,"width"),g=c.getElementProperty(a,"height");let k=null,h=0;for(let n=0;n<b.length;n++){const m=b[n];if(m===a)continue;var l=c.getElementProperty(m,"left");const p=c.getElementProperty(m,"top"),x=c.getElementProperty(m,"width"),y=c.getElementProperty(m,"height");d<l+x&&d+f>l&&e<p+y&&e+g>p&&(l=Math.max(0,Math.min(d+
f,l+x)-Math.max(d,l))*Math.max(0,Math.min(e+g,p+y)-Math.max(e,p)),l>h&&(h=l,k=m))}return k}function z(a,c,b){let d;if(c==="parent"){var e=b.getElementById(b.currentSceneId());d=a.parentElement.closest(".HYPE_element")||e}else if(typeof c==="string"){if(d=b.getElementById(b.currentSceneId()).querySelector(c),!d)return console.warn('HypeDragController: Within selector "'+c+'" not found.',a),null}else return console.warn('HypeDragController: Invalid within specification. Must be a CSS selector or "parent".',
a),null;e=b.getElementProperty(d,"width");const f=b.getElementProperty(d,"height"),g=b.getElementProperty(a,"width");a=b.getElementProperty(a,"height");if(c==="parent")return{minX:0,maxX:e-g,minY:0,maxY:f-a};c=b.getElementProperty(d,"left");b=b.getElementProperty(d,"top");return{minX:c,maxX:c+e-g,minY:b,maxY:b+f-a}}function A(a,c,b,d,e,f,g){if(!b)return{left:d,top:e};b.minX!==void 0&&(d=Math.max(d,b.minX));b.maxX!==void 0&&(d=Math.min(d,b.maxX));b.minY!==void 0&&(e=Math.max(e,b.minY));b.maxY!==void 0&&
(e=Math.min(e,b.maxY));b.axis==="x"&&(e=g);b.axis==="y"&&(d=f);b.within&&(a=z(c,b.within,a))&&(d=Math.max(a.minX,Math.min(d,a.maxX)),e=Math.max(a.minY,Math.min(e,a.maxY)));return{left:d,top:e}}function v(a,c,b,d,e){function f(n,m,p){if(typeof m!=="number"||typeof p!=="number"||!(p>m))return null;n=(n-m)/(p-m);return n<=0?0:n>=1?1:n}let g,k,h,l;if(b&&(typeof b.minX==="number"&&typeof b.maxX==="number"&&(g=b.minX,k=b.maxX),typeof b.minY==="number"&&typeof b.maxY==="number"&&(h=b.minY,l=b.maxY),(g===
void 0||k===void 0||h===void 0||l===void 0)&&b.within&&(a=z(c,b.within,a)))){if(g===void 0||k===void 0)g=a.minX,k=a.maxX;if(h===void 0||l===void 0)h=a.minY,l=a.maxY}d=f(d,g,k);e=f(e,h,l);return{factorX:d,factorY:e,midpointX:d==null?null:(d-.5)*2,midpointY:e==null?null:(e-.5)*2,percentX:d==null?null:d*100,percentY:e==null?null:e*100}}function G(a,c,b){const d=r(a),e=c.dataset.dragName;if(e){var f=q();if(b.hypeGesturePhase==="start"){var g=a.getElementProperty(c,"left"),k=a.getElementProperty(c,"top");
c.setAttribute("data-initial-left",g);c.setAttribute("data-initial-top",k);d.dragData[e]={initialLeft:g,initialTop:k,initialZ:a.getElementProperty(c,"z-index"),startX:b.hypeGestureXPosition,startY:b.hypeGestureYPosition,isActive:!0};f.bringToFront&&a.setElementProperty(c,"z-index",++d.zCounter);(f=d.interactionMap?.[e])&&typeof f.onStart==="function"&&(g=v(a,c,d.constraints?.[e],g,k),Object.assign(b,g),f.onStart(a,c,b))}if(b.hypeGesturePhase==="move"&&d.dragData[e]){var h=d.dragData[e];g=h.initialLeft+
(b.hypeGestureXPosition-h.startX);f=h.initialTop+(b.hypeGestureYPosition-h.startY);if(k=d.constraints?.[e])f=A(a,c,k,g,f,h.initialLeft,h.initialTop),g=f.left,f=f.top;a.setElementProperty(c,"left",g);a.setElementProperty(c,"top",f);(h=d.interactionMap?.[e])&&typeof h.onProgress==="function"&&(g=v(a,c,k,g,f),Object.assign(b,g),h.onProgress(a,c,b))}(b.hypeGesturePhase==="end"||b.hypeGesturePhase==="cancel")&&d.dragData[e]&&d.dragData[e].isActive&&(d.dragData[e].isActive=!1,g=F(c,a),b.dropTarget=g,(g=
d.interactionMap?.[e])&&typeof g.onDrop==="function"&&(k=d.constraints?.[e],f=a.getElementProperty(c,"left"),h=a.getElementProperty(c,"top"),k=v(a,c,k,f,h),Object.assign(b,k),g.onDrop(a,c,b)),setTimeout(()=>{delete d.dragData[e]},50))}else console.warn('HypeDragController: Draggable element is missing a "data-drag-name" attribute.',c)}function H(a,c){var b=r(a),d=c.dataset.dragName;d&&(b=b.dragData[d])&&(d=q(),a.setElementProperty(c,"left",b.initialLeft,d.snapBackDuration,d.snapBackTiming),a.setElementProperty(c,
"top",b.initialTop,d.snapBackDuration,d.snapBackTiming),d.bringToFront&&a.setElementProperty(c,"z-index",b.initialZ,d.snapBackDuration,"easeinout"))}function I(a,c,b){if(c&&b){if(typeof b==="string"){var d=a.getElementById(a.currentSceneId()).querySelector(b);if(!d)return console.warn('HypeDragController: snapTo selector "'+b+'" did not find an element.')}else if(typeof b==="object"&&b.id)d=b;else return console.warn("HypeDragController: snapTo destination must be an element or selector string.");
b=q();var e=a.getElementProperty(d,"left");d=a.getElementProperty(d,"top");a.setElementProperty(c,"left",e,b.snapToDuration,b.snapToTiming);a.setElementProperty(c,"top",d,b.snapToDuration,b.snapToTiming)}}function J(a,c){c.classList.add("hypeDragElementLocked")}function B(a,c){c.classList.remove("hypeDragElementLocked")}function K(a,c){r(a).interactionMap=c}function L(a,c,b){const d=r(a);Array.isArray(c)?c.forEach(e=>{C(a,d,e,b)}):C(a,d,c,b)}function C(a,c,b,d){let e,f;if(typeof b==="string"){if(e=
b,f=a.getElementById(a.currentSceneId()).querySelector(`[data-drag-name="${e}"]`),!f){console.warn(`HypeDragController: No element found with data-drag-name="${e}".`,b);return}}else if(f=b,e=b.dataset.dragName,!e){console.warn('HypeDragController: Cannot set constraints on element without "data-drag-name" attribute.',b);return}c.constraints[e]=d||{};(d&&Object.prototype.hasOwnProperty.call(d,"autoSnap")?d.autoSnap:q("autoSnap"))&&setTimeout(()=>{w(a,f)},0)}function w(a,c){var b=r(a),d=c.dataset.dragName;
if(d){var e=b.constraints?.[d];if(e){b=a.getElementProperty(c,"left");d=a.getElementProperty(c,"top");var f=A(a,c,e,b,d,b,d);e=f.left;f=f.top;if(e!==b||f!==d)a.setElementProperty(c,"left",e),a.setElementProperty(c,"top",f),c.setAttribute("data-initial-left",e),c.setAttribute("data-initial-top",f)}}}function M(a){const c=r(a),b=a.getElementById(a.currentSceneId()).querySelectorAll("[data-drag-name]"),d=q("autoSnap");b.forEach(e=>{var f=e.dataset.dragName;const g={};e.hasAttribute("data-drag-min-x")&&
(g.minX=parseFloat(e.getAttribute("data-drag-min-x")));e.hasAttribute("data-drag-max-x")&&(g.maxX=parseFloat(e.getAttribute("data-drag-max-x")));e.hasAttribute("data-drag-min-y")&&(g.minY=parseFloat(e.getAttribute("data-drag-min-y")));e.hasAttribute("data-drag-max-y")&&(g.maxY=parseFloat(e.getAttribute("data-drag-max-y")));e.hasAttribute("data-drag-axis")&&(g.axis=e.getAttribute("data-drag-axis"));e.hasAttribute("data-drag-within")&&(g.within=e.getAttribute("data-drag-within"));Object.keys(g).length>
0&&(c.constraints[f]=g);f=d;e.hasAttribute("data-drag-auto-snap")?f=e.getAttribute("data-drag-auto-snap")==="true":e.hasAttribute("data-drag-autosnap")&&(f=e.getAttribute("data-drag-autosnap")==="true");f&&Object.keys(g).length>0&&setTimeout(()=>{w(a,e)},0)})}function D(a,c){c||=a.getElementById(a.currentSceneId());c.querySelectorAll("[data-drag-name]").forEach(b=>{B(a,b);b.removeAttribute("data-initial-left");b.removeAttribute("data-initial-top")});r(a).interactionMap={};a.customData&&(a.customData.gameState=
{})}let t={bringToFront:!0,snapBackDuration:.4,snapBackTiming:"easeinout",snapToDuration:.3,snapToTiming:"easeout",resetOnSceneUnload:!1,autoSnap:!1};const u={};"HYPE_eventListeners"in window===!1&&(window.HYPE_eventListeners=[]);window.HYPE_eventListeners.push({type:"HypeDocumentLoad",callback:function(a,c,b){E();a.drag={handler:G.bind(null,a),snapBack:H.bind(null,a),snapTo:I.bind(null,a),autoSnap:function(d){w(a,d)},lock:J.bind(null,a),unlock:B.bind(null,a),setInteractionMap:K.bind(null,a),setConstraints:L.bind(null,
a),resetState:D.bind(null,a)};a.customData.gameState={}}});window.HYPE_eventListeners.push({type:"HypeScenePrepareForDisplay",callback:function(a,c,b){M(a)}});window.HYPE_eventListeners.push({type:"HypeSceneUnload",callback:function(a,c,b){q("resetOnSceneUnload")&&D(a,c)}});return{version:"1.4.2",setDefault:function(a,c){typeof a==="object"?t=Object.assign(t,a):t[a]=c},getDefault:q}}());
