/*
 Hype Drag Controller v1.4.1
 Copyright (2024) Max Ziebell, MIT License
*/
'use strict';"HypeDragController"in window===!1&&(window.HypeDragController=function(){function l(a){return a?q[a]:q}function C(){if(!document.getElementById("HypeDragControllerStyles")){var a=document.createElement("style");a.id="HypeDragControllerStyles";a.innerHTML=".hypeDragElementLocked, .hypeDragElementLocked * { pointer-events: none !important; }";document.head.appendChild(a)}}function m(a){a=a.documentId();t[a]||(t[a]={dragData:{},interactionMap:{},constraints:{},zCounter:1E4});return t[a]}
function D(a,c){const b=c.getElementById(c.currentSceneId()).querySelectorAll("[data-drop-target]"),e=c.getElementProperty(a,"left"),d=c.getElementProperty(a,"top"),f=c.getElementProperty(a,"width"),g=c.getElementProperty(a,"height");let h=null,k=0;for(let u=0;u<b.length;u++){const p=b[u];if(p===a)continue;var n=c.getElementProperty(p,"left");const r=c.getElementProperty(p,"top"),w=c.getElementProperty(p,"width"),x=c.getElementProperty(p,"height");e<n+w&&e+f>n&&d<r+x&&d+g>r&&(n=Math.max(0,Math.min(e+
f,n+w)-Math.max(e,n))*Math.max(0,Math.min(d+g,r+x)-Math.max(d,r)),n>k&&(k=n,h=p))}return h}function y(a,c,b,e,d,f,g){if(!b)return{left:e,top:d};b.minX!==void 0&&(e=Math.max(e,b.minX));b.maxX!==void 0&&(e=Math.min(e,b.maxX));b.minY!==void 0&&(d=Math.max(d,b.minY));b.maxY!==void 0&&(d=Math.min(d,b.maxY));b.axis==="x"&&(d=g);b.axis==="y"&&(e=f);if(b.within){a:{var h=b.within;let k;if(h==="parent")b=a.getElementById(a.currentSceneId()),k=c.parentElement.closest(".HYPE_element")||b;else if(typeof h===
"string"){if(k=a.getElementById(a.currentSceneId()).querySelector(h),!k){console.warn('HypeDragController: Within selector "'+h+'" not found.',c);a=null;break a}}else{console.warn('HypeDragController: Invalid within specification. Must be a CSS selector or "parent".',c);a=null;break a}b=a.getElementProperty(k,"width");f=a.getElementProperty(k,"height");g=a.getElementProperty(c,"width");c=a.getElementProperty(c,"height");h==="parent"?a={minX:0,maxX:b-g,minY:0,maxY:f-c}:(h=a.getElementProperty(k,"left"),
a=a.getElementProperty(k,"top"),a={minX:h,maxX:h+b-g,minY:a,maxY:a+f-c})}a&&(e=Math.max(a.minX,Math.min(e,a.maxX)),d=Math.max(a.minY,Math.min(d,a.maxY)))}return{left:e,top:d}}function E(a,c,b){const e=m(a),d=c.dataset.dragName;if(d){var f=l();if(b.hypeGesturePhase==="start"){var g=a.getElementProperty(c,"left"),h=a.getElementProperty(c,"top");c.setAttribute("data-initial-left",g);c.setAttribute("data-initial-top",h);e.dragData[d]={initialLeft:g,initialTop:h,initialZ:a.getElementProperty(c,"z-index"),
startX:b.hypeGestureXPosition,startY:b.hypeGestureYPosition,isActive:!0};f.bringToFront&&a.setElementProperty(c,"z-index",++e.zCounter);if((f=e.interactionMap?.[d])&&typeof f.onStart==="function")f.onStart(a,c,b)}if(b.hypeGesturePhase==="move"&&e.dragData[d]){g=e.dragData[d];f=g.initialLeft+(b.hypeGestureXPosition-g.startX);h=g.initialTop+(b.hypeGestureYPosition-g.startY);const k=e.constraints?.[d];k&&(g=y(a,c,k,f,h,g.initialLeft,g.initialTop),f=g.left,h=g.top);a.setElementProperty(c,"left",f);a.setElementProperty(c,
"top",h);if((f=e.interactionMap?.[d])&&typeof f.onProgress==="function")f.onProgress(a,c,b)}if((b.hypeGesturePhase==="end"||b.hypeGesturePhase==="cancel")&&e.dragData[d]&&e.dragData[d].isActive){e.dragData[d].isActive=!1;f=D(c,a);b.dropTarget=f;if((f=e.interactionMap?.[d])&&typeof f.onDrop==="function")f.onDrop(a,c,b);setTimeout(()=>{delete e.dragData[d]},50)}}else console.warn('HypeDragController: Draggable element is missing a "data-drag-name" attribute.',c)}function F(a,c){var b=m(a),e=c.dataset.dragName;
e&&(b=b.dragData[e])&&(e=l(),a.setElementProperty(c,"left",b.initialLeft,e.snapBackDuration,e.snapBackTiming),a.setElementProperty(c,"top",b.initialTop,e.snapBackDuration,e.snapBackTiming),e.bringToFront&&a.setElementProperty(c,"z-index",b.initialZ,e.snapBackDuration,"easeinout"))}function G(a,c,b){if(c&&b){if(typeof b==="string"){var e=a.getElementById(a.currentSceneId()).querySelector(b);if(!e)return console.warn('HypeDragController: snapTo selector "'+b+'" did not find an element.')}else if(typeof b===
"object"&&b.id)e=b;else return console.warn("HypeDragController: snapTo destination must be an element or selector string.");b=l();var d=a.getElementProperty(e,"left");e=a.getElementProperty(e,"top");a.setElementProperty(c,"left",d,b.snapToDuration,b.snapToTiming);a.setElementProperty(c,"top",e,b.snapToDuration,b.snapToTiming)}}function H(a,c){c.classList.add("hypeDragElementLocked")}function z(a,c){c.classList.remove("hypeDragElementLocked")}function I(a,c){m(a).interactionMap=c}function J(a,c,b){const e=
m(a);Array.isArray(c)?c.forEach(d=>{A(a,e,d,b)}):A(a,e,c,b)}function A(a,c,b,e){let d,f;if(typeof b==="string"){if(d=b,f=a.getElementById(a.currentSceneId()).querySelector(`[data-drag-name="${d}"]`),!f){console.warn(`HypeDragController: No element found with data-drag-name="${d}".`,b);return}}else if(f=b,d=b.dataset.dragName,!d){console.warn('HypeDragController: Cannot set constraints on element without "data-drag-name" attribute.',b);return}c.constraints[d]=e||{};(e&&Object.prototype.hasOwnProperty.call(e,
"autoSnap")?e.autoSnap:l("autoSnap"))&&setTimeout(()=>{v(a,f)},0)}function v(a,c){var b=m(a),e=c.dataset.dragName;if(e){var d=b.constraints?.[e];if(d){b=a.getElementProperty(c,"left");e=a.getElementProperty(c,"top");var f=y(a,c,d,b,e,b,e);d=f.left;f=f.top;if(d!==b||f!==e)a.setElementProperty(c,"left",d),a.setElementProperty(c,"top",f),c.setAttribute("data-initial-left",d),c.setAttribute("data-initial-top",f)}}}function K(a){const c=m(a),b=a.getElementById(a.currentSceneId()).querySelectorAll("[data-drag-name]"),
e=l("autoSnap");b.forEach(d=>{var f=d.dataset.dragName;const g={};d.hasAttribute("data-drag-min-x")&&(g.minX=parseFloat(d.getAttribute("data-drag-min-x")));d.hasAttribute("data-drag-max-x")&&(g.maxX=parseFloat(d.getAttribute("data-drag-max-x")));d.hasAttribute("data-drag-min-y")&&(g.minY=parseFloat(d.getAttribute("data-drag-min-y")));d.hasAttribute("data-drag-max-y")&&(g.maxY=parseFloat(d.getAttribute("data-drag-max-y")));d.hasAttribute("data-drag-axis")&&(g.axis=d.getAttribute("data-drag-axis"));
d.hasAttribute("data-drag-within")&&(g.within=d.getAttribute("data-drag-within"));Object.keys(g).length>0&&(c.constraints[f]=g);f=e;d.hasAttribute("data-drag-auto-snap")?f=d.getAttribute("data-drag-auto-snap")==="true":d.hasAttribute("data-drag-autosnap")&&(f=d.getAttribute("data-drag-autosnap")==="true");f&&Object.keys(g).length>0&&setTimeout(()=>{v(a,d)},0)})}function B(a,c){c||=a.getElementById(a.currentSceneId());c.querySelectorAll("[data-drag-name]").forEach(b=>{z(a,b);b.removeAttribute("data-initial-left");
b.removeAttribute("data-initial-top")});m(a).interactionMap={};a.customData&&(a.customData.gameState={})}let q={bringToFront:!0,snapBackDuration:.4,snapBackTiming:"easeinout",snapToDuration:.3,snapToTiming:"easeout",resetOnSceneUnload:!1,autoSnap:!1};const t={};"HYPE_eventListeners"in window===!1&&(window.HYPE_eventListeners=[]);window.HYPE_eventListeners.push({type:"HypeDocumentLoad",callback:function(a,c,b){C();a.drag={handler:E.bind(null,a),snapBack:F.bind(null,a),snapTo:G.bind(null,a),autoSnap:function(e){v(a,
e)},lock:H.bind(null,a),unlock:z.bind(null,a),setInteractionMap:I.bind(null,a),setConstraints:J.bind(null,a),resetState:B.bind(null,a)};a.customData.gameState={}}});window.HYPE_eventListeners.push({type:"HypeScenePrepareForDisplay",callback:function(a,c,b){K(a)}});window.HYPE_eventListeners.push({type:"HypeSceneUnload",callback:function(a,c,b){l("resetOnSceneUnload")&&B(a,c)}});return{version:"1.4.1",setDefault:function(a,c){typeof a==="object"?q=Object.assign(q,a):q[a]=c},getDefault:l}}());
