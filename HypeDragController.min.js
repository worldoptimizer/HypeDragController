/*
 Hype Drag Controller v1.3.1
 Copyright (2024) Max Ziebell, MIT License
*/
'use strict';"HypeDragController"in window===!1&&(window.HypeDragController=function(){function m(a){return a?n[a]:n}function p(a){a=a.documentId();r[a]||(r[a]={dragData:{},interactionMap:{}});return r[a]}function z(a,b){const c=b.getElementById(b.currentSceneId()).querySelectorAll("[data-drop-target]"),d=b.getElementProperty(a,"left"),f=b.getElementProperty(a,"top"),e=b.getElementProperty(a,"width"),g=b.getElementProperty(a,"height");let h=null,u=0;for(let t=0;t<c.length;t++){const l=c[t];if(l===
a)continue;var k=b.getElementProperty(l,"left");const q=b.getElementProperty(l,"top"),v=b.getElementProperty(l,"width"),w=b.getElementProperty(l,"height");d<k+v&&d+e>k&&f<q+w&&f+g>q&&(k=Math.max(0,Math.min(d+e,k+v)-Math.max(d,k))*Math.max(0,Math.min(f+g,q+w)-Math.max(f,q)),k>u&&(u=k,h=l))}return h}function A(a,b,c){const d=p(a),f=b.dataset.dragName;if(f){var e=m();if(c.hypeGesturePhase==="start"){let h;if(b.hasAttribute("data-initial-left")){var g=parseFloat(b.getAttribute("data-initial-left"));h=
parseFloat(b.getAttribute("data-initial-top"))}else g=a.getElementProperty(b,"left"),h=a.getElementProperty(b,"top"),b.setAttribute("data-initial-left",g),b.setAttribute("data-initial-top",h);d.dragData[f]={initialLeft:g,initialTop:h,initialZ:a.getElementProperty(b,"z-index"),startX:c.hypeGestureXPosition,startY:c.hypeGestureYPosition,isActive:!0};e.bringToFront&&a.setElementProperty(b,"z-index",9999);if((e=d.interactionMap?.[f])&&typeof e.onStart==="function")e.onStart(a,b,c)}if(c.hypeGesturePhase===
"move"&&d.dragData[f]&&(e=d.dragData[f],g=e.initialTop+(c.hypeGestureYPosition-e.startY),a.setElementProperty(b,"left",e.initialLeft+(c.hypeGestureXPosition-e.startX)),a.setElementProperty(b,"top",g),(e=d.interactionMap?.[f])&&typeof e.onProgress==="function"))e.onProgress(a,b,c);if((c.hypeGesturePhase==="end"||c.hypeGesturePhase==="cancel")&&d.dragData[f]&&d.dragData[f].isActive){d.dragData[f].isActive=!1;e=z(b,a);c.dropTarget=e;if((e=d.interactionMap?.[f])&&typeof e.onDrop==="function")e.onDrop(a,
b,c);setTimeout(()=>{delete d.dragData[f]},50)}}else console.warn('HypeDragController: Draggable element is missing a "data-drag-name" attribute.',b)}function B(a,b){var c=p(a),d=b.dataset.dragName;d&&(c=c.dragData[d])&&(d=m(),a.setElementProperty(b,"left",c.initialLeft,d.snapBackDuration,d.snapBackTiming),a.setElementProperty(b,"top",c.initialTop,d.snapBackDuration,d.snapBackTiming),d.bringToFront&&a.setElementProperty(b,"z-index",c.initialZ,d.snapBackDuration,"easeinout"))}function C(a,b,c){if(b&&
c){if(typeof c==="string"){var d=a.getElementById(a.currentSceneId()).querySelector(c);if(!d)return console.warn('HypeDragController: snapTo selector "'+c+'" did not find an element.')}else if(typeof c==="object"&&c.id)d=c;else return console.warn("HypeDragController: snapTo destination must be an element or selector string.");c=m();var f=a.getElementProperty(d,"left");d=a.getElementProperty(d,"top");a.setElementProperty(b,"left",f,c.snapToDuration,c.snapToTiming);a.setElementProperty(b,"top",d,c.snapToDuration,
c.snapToTiming)}}function D(a,b){b.classList.add("hypeDragElementLocked")}function x(a,b){b.classList.remove("hypeDragElementLocked")}function E(a,b){p(a).interactionMap=b}function y(a,b){b||=a.getElementById(a.currentSceneId());b.querySelectorAll("[data-drag-name]").forEach(c=>{x(a,c);c.removeAttribute("data-initial-left");c.removeAttribute("data-initial-top")});p(a).interactionMap={};a.customData&&(a.customData.gameState={})}let n={bringToFront:!0,snapBackDuration:.4,snapBackTiming:"easeinout",
snapToDuration:.3,snapToTiming:"easeout",resetOnSceneUnload:!1};const r={};"HYPE_eventListeners"in window===!1&&(window.HYPE_eventListeners=[]);window.HYPE_eventListeners.push({type:"HypeDocumentLoad",callback:function(a,b,c){document.getElementById("HypeDragControllerStyles")||(b=document.createElement("style"),b.id="HypeDragControllerStyles",b.innerHTML=".hypeDragElementLocked, .hypeDragElementLocked * { pointer-events: none !important; }",document.head.appendChild(b));a.drag={handler:A.bind(null,
a),snapBack:B.bind(null,a),snapTo:C.bind(null,a),lock:D.bind(null,a),unlock:x.bind(null,a),setInteractionMap:E.bind(null,a),resetState:y.bind(null,a)};a.customData.gameState={}}});window.HYPE_eventListeners.push({type:"HypeSceneUnload",callback:function(a,b,c){m("resetOnSceneUnload")&&y(a,b)}});return{version:"1.3.1",setDefault:function(a,b){typeof a==="object"?n=Object.assign(n,a):n[a]=b},getDefault:m}}());
