/*
 Hype Drag Controller v1.4.0
 Copyright (2024) Max Ziebell, MIT License
*/
'use strict';"HypeDragController"in window===!1&&(window.HypeDragController=function(){function p(a){return a?q[a]:q}function m(a){a=a.documentId();t[a]||(t[a]={dragData:{},interactionMap:{},constraints:{}});return t[a]}function A(a,c){const b=c.getElementById(c.currentSceneId()).querySelectorAll("[data-drop-target]"),d=c.getElementProperty(a,"left"),e=c.getElementProperty(a,"top"),f=c.getElementProperty(a,"width"),g=c.getElementProperty(a,"height");let h=null,k=0;for(let u=0;u<b.length;u++){const n=
b[u];if(n===a)continue;var l=c.getElementProperty(n,"left");const r=c.getElementProperty(n,"top"),v=c.getElementProperty(n,"width"),w=c.getElementProperty(n,"height");d<l+v&&d+f>l&&e<r+w&&e+g>r&&(l=Math.max(0,Math.min(d+f,l+v)-Math.max(d,l))*Math.max(0,Math.min(e+g,r+w)-Math.max(e,r)),l>k&&(k=l,h=n))}return h}function B(a,c,b){let d;if(c==="parent"){var e=b.getElementById(b.currentSceneId());d=a.parentElement.closest(".HYPE_element")||e}else if(typeof c==="string"){if(d=b.getElementById(b.currentSceneId()).querySelector(c),
!d)return console.warn('HypeDragController: Containment selector "'+c+'" not found.',a),null}else return console.warn('HypeDragController: Invalid containment specification. Must be a CSS class selector or "parent".',a),null;e=b.getElementProperty(d,"width");const f=b.getElementProperty(d,"height"),g=b.getElementProperty(a,"width");a=b.getElementProperty(a,"height");if(c==="parent")return{minX:0,maxX:e-g,minY:0,maxY:f-a};c=b.getElementProperty(d,"left");b=b.getElementProperty(d,"top");return{minX:c,
maxX:c+e-g,minY:b,maxY:b+f-a}}function C(a,c,b){const d=m(a),e=c.dataset.dragName;if(e){var f=p();if(b.hypeGesturePhase==="start"){if(c.hasAttribute("data-initial-left")){var g=parseFloat(c.getAttribute("data-initial-left"));var h=parseFloat(c.getAttribute("data-initial-top"))}else g=a.getElementProperty(c,"left"),h=a.getElementProperty(c,"top"),c.setAttribute("data-initial-left",g),c.setAttribute("data-initial-top",h);d.dragData[e]={initialLeft:g,initialTop:h,initialZ:a.getElementProperty(c,"z-index"),
startX:b.hypeGestureXPosition,startY:b.hypeGestureYPosition,isActive:!0};f.bringToFront&&a.setElementProperty(c,"z-index",9999);if((f=d.interactionMap?.[e])&&typeof f.onStart==="function")f.onStart(a,c,b)}if(b.hypeGesturePhase==="move"&&d.dragData[e]){h=d.dragData[e];f=h.initialLeft+(b.hypeGestureXPosition-h.startX);g=h.initialTop+(b.hypeGestureYPosition-h.startY);const k=d.constraints?.[e];k&&(k.minX!==void 0&&(f=Math.max(f,k.minX)),k.maxX!==void 0&&(f=Math.min(f,k.maxX)),k.minY!==void 0&&(g=Math.max(g,
k.minY)),k.maxY!==void 0&&(g=Math.min(g,k.maxY)),k.axis==="x"&&(g=h.initialTop),k.axis==="y"&&(f=h.initialLeft),k.containment&&(h=B(c,k.containment,a)))&&(f=Math.max(h.minX,Math.min(f,h.maxX)),g=Math.max(h.minY,Math.min(g,h.maxY)));a.setElementProperty(c,"left",f);a.setElementProperty(c,"top",g);if((f=d.interactionMap?.[e])&&typeof f.onProgress==="function")f.onProgress(a,c,b)}if((b.hypeGesturePhase==="end"||b.hypeGesturePhase==="cancel")&&d.dragData[e]&&d.dragData[e].isActive){d.dragData[e].isActive=
!1;f=A(c,a);b.dropTarget=f;if((f=d.interactionMap?.[e])&&typeof f.onDrop==="function")f.onDrop(a,c,b);setTimeout(()=>{delete d.dragData[e]},50)}}else console.warn('HypeDragController: Draggable element is missing a "data-drag-name" attribute.',c)}function D(a,c){var b=m(a),d=c.dataset.dragName;d&&(b=b.dragData[d])&&(d=p(),a.setElementProperty(c,"left",b.initialLeft,d.snapBackDuration,d.snapBackTiming),a.setElementProperty(c,"top",b.initialTop,d.snapBackDuration,d.snapBackTiming),d.bringToFront&&a.setElementProperty(c,
"z-index",b.initialZ,d.snapBackDuration,"easeinout"))}function E(a,c,b){if(c&&b){if(typeof b==="string"){var d=a.getElementById(a.currentSceneId()).querySelector(b);if(!d)return console.warn('HypeDragController: snapTo selector "'+b+'" did not find an element.')}else if(typeof b==="object"&&b.id)d=b;else return console.warn("HypeDragController: snapTo destination must be an element or selector string.");b=p();var e=a.getElementProperty(d,"left");d=a.getElementProperty(d,"top");a.setElementProperty(c,
"left",e,b.snapToDuration,b.snapToTiming);a.setElementProperty(c,"top",d,b.snapToDuration,b.snapToTiming)}}function F(a,c){c.classList.add("hypeDragElementLocked")}function x(a,c){c.classList.remove("hypeDragElementLocked")}function G(a,c){m(a).interactionMap=c}function H(a,c,b){const d=m(a);Array.isArray(c)?c.forEach(e=>{y(a,d,e,b)}):y(a,d,c,b)}function y(a,c,b,d){let e;if(typeof b==="string"){if(e=b,a=a.getElementById(a.currentSceneId()).querySelector(`[data-drag-name="${e}"]`),!a){console.warn(`HypeDragController: No element found with data-drag-name="${e}".`,
b);return}}else if(e=b.dataset.dragName,!e){console.warn('HypeDragController: Cannot set constraints on element without "data-drag-name" attribute.',b);return}c.constraints[e]=d||{}}function I(a){const c=m(a);a.getElementById(a.currentSceneId()).querySelectorAll("[data-drag-name]").forEach(b=>{const d=b.dataset.dragName,e={};b.hasAttribute("data-constraint-min-x")&&(e.minX=parseFloat(b.getAttribute("data-constraint-min-x")));b.hasAttribute("data-constraint-max-x")&&(e.maxX=parseFloat(b.getAttribute("data-constraint-max-x")));
b.hasAttribute("data-constraint-min-y")&&(e.minY=parseFloat(b.getAttribute("data-constraint-min-y")));b.hasAttribute("data-constraint-max-y")&&(e.maxY=parseFloat(b.getAttribute("data-constraint-max-y")));b.hasAttribute("data-constraint-axis")&&(e.axis=b.getAttribute("data-constraint-axis"));b.hasAttribute("data-constraint-containment")&&(e.containment=b.getAttribute("data-constraint-containment"));Object.keys(e).length>0&&(c.constraints[d]=e)})}function z(a,c){c||=a.getElementById(a.currentSceneId());
c.querySelectorAll("[data-drag-name]").forEach(b=>{x(a,b);b.removeAttribute("data-initial-left");b.removeAttribute("data-initial-top")});m(a).interactionMap={};a.customData&&(a.customData.gameState={})}let q={bringToFront:!0,snapBackDuration:.4,snapBackTiming:"easeinout",snapToDuration:.3,snapToTiming:"easeout",resetOnSceneUnload:!1};const t={};"HYPE_eventListeners"in window===!1&&(window.HYPE_eventListeners=[]);window.HYPE_eventListeners.push({type:"HypeDocumentLoad",callback:function(a,c,b){document.getElementById("HypeDragControllerStyles")||
(c=document.createElement("style"),c.id="HypeDragControllerStyles",c.innerHTML=".hypeDragElementLocked, .hypeDragElementLocked * { pointer-events: none !important; }",document.head.appendChild(c));a.drag={handler:C.bind(null,a),snapBack:D.bind(null,a),snapTo:E.bind(null,a),lock:F.bind(null,a),unlock:x.bind(null,a),setInteractionMap:G.bind(null,a),setConstraints:H.bind(null,a),resetState:z.bind(null,a)};a.customData.gameState={}}});window.HYPE_eventListeners.push({type:"HypeScenePrepareForDisplay",
callback:function(a,c,b){I(a)}});window.HYPE_eventListeners.push({type:"HypeSceneUnload",callback:function(a,c,b){p("resetOnSceneUnload")&&z(a,c)}});return{version:"1.4.0",setDefault:function(a,c){typeof a==="object"?q=Object.assign(q,a):q[a]=c},getDefault:p}}());
